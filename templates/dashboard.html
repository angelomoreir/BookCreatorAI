<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - BookCreatorAI</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="min-h-screen bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900">
    <!-- Navigation -->
    <nav class="bg-black/30 backdrop-blur-lg border-b border-white/10 sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <a href="/" class="flex items-center space-x-3">
                        <svg class="w-8 h-8 text-purple-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"></path>
                        </svg>
                        <span class="text-xl font-bold text-white">BookCreatorAI</span>
                    </a>
                </div>
                <div class="flex items-center space-x-4">
                    <a href="/" class="text-gray-300 hover:text-white transition-colors px-3 py-2 rounded-lg hover:bg-white/10">Criar</a>
                    <a href="/books" class="text-gray-300 hover:text-white transition-colors px-3 py-2 rounded-lg hover:bg-white/10">Livros</a>
                    <a href="/dashboard" class="text-white bg-purple-600/30 px-3 py-2 rounded-lg">Dashboard</a>
                </div>
            </div>
        </div>
    </nav>

    <main class="max-w-7xl mx-auto px-4 py-8">
        <div class="flex items-center justify-between mb-8">
            <h1 class="text-3xl font-bold text-white">üìä Dashboard</h1>
            <p class="text-gray-400">Vis√£o geral da sua biblioteca</p>
        </div>

        <!-- Main Stats Cards -->
        <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8">
            <div class="bg-gradient-to-br from-purple-600/30 to-purple-800/30 backdrop-blur-lg rounded-2xl border border-purple-500/30 p-6">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-purple-300 text-sm">Total de Livros</p>
                        <p class="text-4xl font-bold text-white mt-1" id="totalBooks">0</p>
                    </div>
                    <div class="w-12 h-12 bg-purple-500/30 rounded-xl flex items-center justify-center">
                        <span class="text-2xl">üìö</span>
                    </div>
                </div>
            </div>
            
            <div class="bg-gradient-to-br from-blue-600/30 to-blue-800/30 backdrop-blur-lg rounded-2xl border border-blue-500/30 p-6">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-blue-300 text-sm">Total de Palavras</p>
                        <p class="text-4xl font-bold text-white mt-1" id="totalWords">0</p>
                    </div>
                    <div class="w-12 h-12 bg-blue-500/30 rounded-xl flex items-center justify-center">
                        <span class="text-2xl">‚úçÔ∏è</span>
                    </div>
                </div>
            </div>
            
            <div class="bg-gradient-to-br from-green-600/30 to-green-800/30 backdrop-blur-lg rounded-2xl border border-green-500/30 p-6">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-green-300 text-sm">Total de P√°ginas</p>
                        <p class="text-4xl font-bold text-white mt-1" id="totalPages">0</p>
                    </div>
                    <div class="w-12 h-12 bg-green-500/30 rounded-xl flex items-center justify-center">
                        <span class="text-2xl">üìÑ</span>
                    </div>
                </div>
            </div>
            
            <div class="bg-gradient-to-br from-pink-600/30 to-pink-800/30 backdrop-blur-lg rounded-2xl border border-pink-500/30 p-6">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-pink-300 text-sm">Favoritos</p>
                        <p class="text-4xl font-bold text-white mt-1" id="totalFavorites">0</p>
                    </div>
                    <div class="w-12 h-12 bg-pink-500/30 rounded-xl flex items-center justify-center">
                        <span class="text-2xl">‚≠ê</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Secondary Stats -->
        <div class="grid grid-cols-2 md:grid-cols-5 gap-4 mb-8">
            <div class="bg-white/5 backdrop-blur-lg rounded-xl border border-white/10 p-4 text-center">
                <p class="text-gray-400 text-xs">Cap√≠tulos</p>
                <p class="text-2xl font-bold text-white" id="totalChapters">0</p>
            </div>
            <div class="bg-white/5 backdrop-blur-lg rounded-xl border border-white/10 p-4 text-center">
                <p class="text-gray-400 text-xs">Tempo Leitura</p>
                <p class="text-2xl font-bold text-white" id="totalReadingTime">0h</p>
            </div>
            <div class="bg-white/5 backdrop-blur-lg rounded-xl border border-white/10 p-4 text-center">
                <p class="text-gray-400 text-xs">M√©dia Palavras/Livro</p>
                <p class="text-2xl font-bold text-white" id="avgWordsPerBook">0</p>
            </div>
            <div class="bg-white/5 backdrop-blur-lg rounded-xl border border-white/10 p-4 text-center">
                <p class="text-gray-400 text-xs">S√©ries</p>
                <p class="text-2xl font-bold text-white" id="totalSeries">0</p>
            </div>
            <div class="bg-white/5 backdrop-blur-lg rounded-xl border border-white/10 p-4 text-center">
                <p class="text-gray-400 text-xs">Tags √önicas</p>
                <p class="text-2xl font-bold text-white" id="totalTags">0</p>
            </div>
        </div>

        <div class="grid lg:grid-cols-2 gap-8 mb-8">
            <!-- Books by Style Chart -->
            <div class="bg-white/10 backdrop-blur-lg rounded-2xl border border-white/20 p-6">
                <h3 class="text-lg font-bold text-white mb-4">üìä Livros por Estilo</h3>
                <div class="h-64">
                    <canvas id="styleChart"></canvas>
                </div>
            </div>
            
            <!-- Books by Language Chart -->
            <div class="bg-white/10 backdrop-blur-lg rounded-2xl border border-white/20 p-6">
                <h3 class="text-lg font-bold text-white mb-4">üåç Livros por Idioma</h3>
                <div class="h-64">
                    <canvas id="languageChart"></canvas>
                </div>
            </div>
        </div>

        <div class="grid lg:grid-cols-3 gap-8 mb-8">
            <!-- Recent Books -->
            <div class="lg:col-span-2 bg-white/10 backdrop-blur-lg rounded-2xl border border-white/20 p-6">
                <h3 class="text-lg font-bold text-white mb-4">üìñ Livros Recentes</h3>
                <div id="recentBooks" class="space-y-3">
                    <!-- Populated by JS -->
                </div>
            </div>
            
            <!-- Top Tags -->
            <div class="bg-white/10 backdrop-blur-lg rounded-2xl border border-white/20 p-6">
                <h3 class="text-lg font-bold text-white mb-4">üè∑Ô∏è Tags Populares</h3>
                <div id="topTags" class="flex flex-wrap gap-2">
                    <!-- Populated by JS -->
                </div>
            </div>
        </div>

        <!-- Activity Timeline -->
        <div class="bg-white/10 backdrop-blur-lg rounded-2xl border border-white/20 p-6">
            <h3 class="text-lg font-bold text-white mb-4">üìÖ Atividade Recente</h3>
            <div class="h-48">
                <canvas id="activityChart"></canvas>
            </div>
        </div>
    </main>

    <script src="{{ url_for('static', filename='i18n.js') }}"></script>
    <script src="{{ url_for('static', filename='script.js') }}"></script>
    <script>
        // Load dashboard data
        document.addEventListener('DOMContentLoaded', loadDashboard);
        
        async function loadDashboard() {
            try {
                const response = await fetch('/api/dashboard');
                const data = await response.json();
                
                if (data.success) {
                    updateStats(data.stats);
                    createCharts(data.stats);
                    displayRecentBooks(data.recent_books);
                    displayTopTags(data.top_tags);
                }
            } catch (error) {
                console.error('Error loading dashboard:', error);
            }
        }
        
        function updateStats(stats) {
            document.getElementById('totalBooks').textContent = stats.total_books || 0;
            document.getElementById('totalWords').textContent = formatNumber(stats.total_words || 0);
            document.getElementById('totalPages').textContent = formatNumber(stats.total_pages || 0);
            document.getElementById('totalFavorites').textContent = stats.favorites_count || 0;
            document.getElementById('totalChapters').textContent = stats.total_chapters || 0;
            document.getElementById('totalReadingTime').textContent = formatReadingTime(stats.total_reading_time || 0);
            document.getElementById('avgWordsPerBook').textContent = formatNumber(stats.avg_words_per_book || 0);
            document.getElementById('totalSeries').textContent = stats.total_series || 0;
            document.getElementById('totalTags').textContent = stats.unique_tags || 0;
        }
        
        function formatNumber(num) {
            if (num >= 1000000) return (num / 1000000).toFixed(1) + 'M';
            if (num >= 1000) return (num / 1000).toFixed(1) + 'K';
            return num.toString();
        }
        
        function formatReadingTime(minutes) {
            if (minutes >= 60) {
                const hours = Math.floor(minutes / 60);
                return hours + 'h';
            }
            return minutes + 'm';
        }
        
        function createCharts(stats) {
            // Style Chart
            const styleCtx = document.getElementById('styleChart').getContext('2d');
            const styles = stats.by_style || {};
            new Chart(styleCtx, {
                type: 'doughnut',
                data: {
                    labels: Object.keys(styles),
                    datasets: [{
                        data: Object.values(styles),
                        backgroundColor: [
                            '#8B5CF6', '#EC4899', '#3B82F6', '#10B981', 
                            '#F59E0B', '#EF4444', '#6366F1', '#14B8A6'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'right',
                            labels: { color: '#fff', font: { size: 11 } }
                        }
                    }
                }
            });
            
            // Language Chart
            const langCtx = document.getElementById('languageChart').getContext('2d');
            const languages = stats.by_language || {};
            const langLabels = {
                'pt-pt': 'üáµüáπ Portugu√™s (PT)',
                'pt-br': 'üáßüá∑ Portugu√™s (BR)',
                'en': 'üá¨üáß English',
                'fr': 'üá´üá∑ Fran√ßais',
                'de': 'üá©üá™ Deutsch',
                'it': 'üáÆüáπ Italiano'
            };
            new Chart(langCtx, {
                type: 'bar',
                data: {
                    labels: Object.keys(languages).map(l => langLabels[l] || l),
                    datasets: [{
                        label: 'Livros',
                        data: Object.values(languages),
                        backgroundColor: '#8B5CF6'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false }
                    },
                    scales: {
                        y: { 
                            beginAtZero: true,
                            ticks: { color: '#9CA3AF' },
                            grid: { color: 'rgba(255,255,255,0.1)' }
                        },
                        x: { 
                            ticks: { color: '#9CA3AF' },
                            grid: { display: false }
                        }
                    }
                }
            });
            
            // Activity Chart
            const activityCtx = document.getElementById('activityChart').getContext('2d');
            const activity = stats.activity_by_day || {};
            new Chart(activityCtx, {
                type: 'line',
                data: {
                    labels: Object.keys(activity),
                    datasets: [{
                        label: 'Livros criados',
                        data: Object.values(activity),
                        borderColor: '#8B5CF6',
                        backgroundColor: 'rgba(139, 92, 246, 0.1)',
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false }
                    },
                    scales: {
                        y: { 
                            beginAtZero: true,
                            ticks: { color: '#9CA3AF' },
                            grid: { color: 'rgba(255,255,255,0.1)' }
                        },
                        x: { 
                            ticks: { color: '#9CA3AF' },
                            grid: { display: false }
                        }
                    }
                }
            });
        }
        
        function displayRecentBooks(books) {
            const container = document.getElementById('recentBooks');
            if (!books || books.length === 0) {
                container.innerHTML = '<p class="text-gray-400 text-center py-4">Nenhum livro ainda</p>';
                return;
            }
            
            container.innerHTML = books.slice(0, 5).map(book => `
                <a href="/book/${book.id}" class="flex items-center justify-between p-3 bg-white/5 rounded-lg hover:bg-white/10 transition-colors">
                    <div class="flex items-center gap-3">
                        <span class="text-2xl">${book.is_favorite ? '‚≠ê' : 'üìñ'}</span>
                        <div>
                            <p class="text-white font-medium">${book.title}</p>
                            <p class="text-xs text-gray-400">${book.style} ‚Ä¢ ${book.word_count || 0} palavras</p>
                        </div>
                    </div>
                    <span class="text-xs text-gray-500">${book.created_at}</span>
                </a>
            `).join('');
        }
        
        function displayTopTags(tags) {
            const container = document.getElementById('topTags');
            if (!tags || tags.length === 0) {
                container.innerHTML = '<p class="text-gray-400 text-sm">Nenhuma tag</p>';
                return;
            }
            
            container.innerHTML = tags.slice(0, 15).map(tag => `
                <span class="px-3 py-1 bg-purple-600/30 text-purple-300 text-sm rounded-full">${tag.name} (${tag.count})</span>
            `).join('');
        }
    </script>
</body>
</html>
